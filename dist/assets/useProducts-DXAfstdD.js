import{k as O,r as i,V as f}from"./index-BkUxVZaB.js";import{p as h}from"./productService-DcEclZUh.js";const R=a=>({id:Math.floor(Math.random()*1e6),title:a.name,body_html:a.description,vendor:a.supplier,product_type:a.productType,variants:[{price:a.price,sku:a.id,inventory_quantity:a.productType==="LooseStone"?a.quantity:1}]}),E={async createProduct(a){return console.log("Creating product on Shopify:",a),Promise.resolve({id:R(a).id})},async updateProduct(a,n){return console.log(`Updating product ${a} on Shopify:`,n),Promise.resolve()},async deleteProduct(a){return console.log(`Deleting product ${a} from Shopify`),Promise.resolve()}},_=O(a=>({productCache:{},singleProductCache:{},setProductCache:(n,y)=>a(d=>({productCache:{...d.productCache,[n]:y}})),setSingleProductCache:(n,y)=>a(d=>({singleProductCache:{...d.singleProductCache,[n]:y}})),clearCaches:()=>a(()=>({productCache:{},singleProductCache:{}}))})),K=400,U=()=>{const[a,n]=i.useState({content:[],totalPages:0,totalElements:0,size:0,number:0}),[y,d]=i.useState(!0),[F,T]=i.useState(null),[c,k]=i.useState({page:1,limit:12,totalItems:0,totalPages:0}),[r,q]=i.useState({}),g=i.useRef(null),{productCache:m,singleProductCache:P,setProductCache:b,setSingleProductCache:v,clearCaches:j}=_(),C=i.useCallback(()=>JSON.stringify({page:c.page,limit:c.limit,...r}),[c.page,c.limit,r]),l=i.useCallback(async()=>{d(!0),T(null);const o=C(),s=m[o];if(s){n(s),d(!1);return}try{let e=(await h.getProducts()).content||[];r.search&&(e=e.filter(t=>t.name.toLowerCase().includes(r.search.toLowerCase()))),r.category&&(e=e.filter(t=>t.productType==="Jewelry"&&t.category===r.category)),r.style&&(e=e.filter(t=>t.productType==="Jewelry"&&t.style===r.style)),r.metal&&(e=e.filter(t=>t.productType==="Jewelry"&&t.metal===r.metal)),r.clarityGrade&&(e=e.filter(t=>t.productType==="LooseStone"&&t.clarityGrade===r.clarityGrade)),r.rarity&&(e=e.filter(t=>t.productType==="CarvedIdol"&&t.rarity===r.rarity)),r.workmanshipGrade&&(e=e.filter(t=>t.productType==="CarvedIdol"&&t.workmanshipGrade===r.workmanshipGrade)),r.dateFrom&&(e=e.filter(t=>new Date(t.acquisitionDate)>=new Date(r.dateFrom))),r.dateTo&&(e=e.filter(t=>new Date(t.acquisitionDate)<=new Date(r.dateTo)));const p=e.length,I=Math.ceil(p/c.limit),D={content:e.slice((c.page-1)*c.limit,c.page*c.limit),totalPages:I,totalElements:p,size:c.limit,number:c.page};b(o,D),n(D),k(t=>({...t,totalItems:p,totalPages:I}))}catch{T("Failed to fetch products"),f.error("Failed to fetch products")}finally{d(!1)}},[C,c.page,c.limit,r,b]);i.useEffect(()=>{const o=C(),s=m[o];if(s){n(s),d(!1);return}return g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{l()},K),()=>{g.current&&clearTimeout(g.current)}},[C]);const w=()=>{Object.keys(m).forEach(o=>delete m[o])},L=i.useCallback(async o=>{if(P[o])return P[o];try{const s=await h.getProduct(o);return s&&v(o,s),s}catch{f.error("Failed to fetch product details");return}},[P,v]),S=()=>{Object.keys(P).forEach(o=>delete P[o])},G=i.useCallback(async o=>{try{const s=await h.createProduct(o),u=await E.createProduct(s),e=await h.updateProduct(s.id,{...s,platformIds:{...s.platformIds,shopifyId:u.id.toString()}});return w(),S(),l(),e}catch(s){throw f.error("Failed to add product"),s}},[l]),M=i.useCallback(async(o,s)=>{var u;try{const e=await h.updateProduct(o,s);(u=e.platformIds)!=null&&u.shopifyId&&await E.updateProduct(parseInt(e.platformIds.shopifyId),e);const p=e.productType==="LooseStone"?e.quantity:e.inventoryQuantity;return p!==void 0&&e.reorderThreshold!==void 0&&p<e.reorderThreshold&&(console.log(`Reorder request for product ${e.name} (ID: ${e.id})`),f.info(`Reorder request for product ${e.name}`)),w(),S(),l(),e}catch(e){throw f.error("Failed to update product"),e}},[l]),$=i.useCallback(async o=>{try{return await h.deleteProduct(o),w(),S(),l(),!0}catch{return f.error("Failed to delete product"),!1}},[l]),J=i.useCallback(()=>{c.page<c.totalPages&&k(o=>({...o,page:o.page+1}))},[c.page,c.totalPages]);return{products:a,loading:y,error:F,pagination:c,hasMore:c.page<c.totalPages,loadMore:J,filters:r,setFilters:q,addProduct:G,updateProduct:M,deleteProduct:$,getProduct:L,refresh:l}};export{E as s,U as u};
