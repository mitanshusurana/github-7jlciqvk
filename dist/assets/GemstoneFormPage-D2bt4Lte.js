import{R as b,j as e,f as N,u as w,r as u,L as P,V as h}from"./index-BkUxVZaB.js";import{u as I}from"./useProducts-DXAfstdD.js";import{F as L,a as D,b as j,E as g,c as f}from"./formik.esm-DW3Up1cQ.js";import{D as E,H as T,u as S,a as A,G as R}from"./index-CkAp2s5T.js";import{A as F}from"./arrow-left-DE6iWCAM.js";import"./productService-DcEclZUh.js";const v={MEDIA:"media"},y=({item:a,index:n,moveItem:d,removeItem:p})=>{const m=b.useRef(null),[,o]=S({accept:v.MEDIA,hover(s){s.index!==n&&(d(s.index,n),s.index=n)}}),[{isDragging:l},t,r]=A({type:v.MEDIA,item:{index:n},collect:s=>({isDragging:s.isDragging()})});return t(o(m)),e.jsx("div",{ref:r,style:{opacity:l?.5:1},className:"relative",children:e.jsxs("div",{ref:m,children:[a.type==="image"?e.jsx("img",{src:a.url,className:"w-24 h-24 object-cover rounded-md"}):e.jsx("video",{src:a.url,className:"w-24 h-24 object-cover rounded-md"}),e.jsx("button",{type:"button",onClick:()=>p(n),className:"absolute top-0 right-0 bg-red-500 text-white rounded-full p-1",children:"X"}),e.jsx("div",{className:"absolute top-0 left-0 bg-black/50 p-1 rounded-br-md cursor-grab",children:e.jsx(R,{className:"h-4 w-4 text-white"})})]})})},M=({product:a,onSubmit:n})=>{const[d,p]=b.useState((a==null?void 0:a.productType)||"LooseStone"),m=a||{productType:"LooseStone",name:"",description:"",images:[],videos:[]};return e.jsx(E,{backend:T,children:e.jsx(L,{initialValues:m,onSubmit:n,enableReinitialize:!0,children:({values:o,setFieldValue:l})=>e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"productType",className:"form-label",children:"Product Type"}),e.jsxs(j,{as:"select",name:"productType",className:"form-select",value:d,onChange:t=>{const r=t.target.value;p(r),l("productType",r)},children:[e.jsx("option",{value:"LooseStone",children:"Loose Stone"}),e.jsx("option",{value:"CarvedIdol",children:"Carved Idol"}),e.jsx("option",{value:"Jewelry",children:"Jewelry"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Name"}),e.jsx(j,{name:"name",className:"form-input"}),e.jsx(g,{name:"name",component:"div",className:"text-error-600 text-sm mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx(j,{name:"description",as:"textarea",rows:3,className:"form-input"}),e.jsx(g,{name:"description",component:"div",className:"text-error-600 text-sm mt-1"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:"Media"}),e.jsx(f,{name:"images",children:({push:t,remove:r})=>e.jsx("div",{children:e.jsx("input",{type:"file",multiple:!0,onChange:s=>{Array.from(s.target.files||[]).forEach(c=>t(URL.createObjectURL(c)))}})})}),e.jsx(f,{name:"videos",children:({push:t,remove:r})=>e.jsx("div",{children:e.jsx("input",{type:"file",multiple:!0,onChange:s=>{Array.from(s.target.files||[]).forEach(c=>t(URL.createObjectURL(c)))}})})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-4",children:[o.images.map((t,r)=>e.jsx(y,{item:{url:t,type:"image"},index:r,moveItem:(s,i)=>{const c=[...o.images],x=c[s];c.splice(s,1),c.splice(i,0,x),l("images",c)},removeItem:s=>{const i=[...o.images];i.splice(s,1),l("images",i)}},t)),o.videos.map((t,r)=>e.jsx(y,{item:{url:t,type:"video"},index:r+o.images.length,moveItem:(s,i)=>{},removeItem:s=>{const i=[...o.videos];i.splice(s,1),l("videos",i)}},t))]})]}),e.jsx("div",{className:"flex justify-end space-x-4",children:e.jsx("button",{type:"submit",className:"btn-primary",children:"Save"})})]})})})},J=()=>{const{id:a}=N(),n=w(),{getProduct:d,addProduct:p,updateProduct:m}=I(),[o,l]=u.useState(null),[t,r]=u.useState(!!a),s=!!a;u.useEffect(()=>{a&&(r(!0),d(a).then(l).finally(()=>r(!1)))},[a,d]);const i=async c=>{try{s&&o?(await m(o.id,c),h.success("Product updated successfully!")):(await p(c),h.success("Product added successfully!")),n("/inventory")}catch(x){h.error("Failed to save product."),console.error(x)}};return t?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"container-page",children:[e.jsxs(P,{to:"/inventory",className:"inline-flex items-center text-neutral-600 hover:text-neutral-900 mb-6",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),"Back to Inventory"]}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-neutral-900 mb-6",children:s?"Edit Product":"Add New Product"}),e.jsx(M,{product:o,onSubmit:i})]})]})};export{J as default};
