import{k as R,r as i,V as f}from"./index-DUtX-tqj.js";import{p as y}from"./productService-BJiI6_8G.js";const _=a=>({id:Math.floor(Math.random()*1e6),title:a.name,body_html:a.description,vendor:a.supplier,product_type:a.productType,variants:[{price:a.price,sku:a.id,inventory_quantity:a.productType==="LooseStone"?a.quantity:1}]}),D={async createProduct(a){return console.log("Creating product on Shopify:",a),Promise.resolve({id:_(a).id})},async updateProduct(a,l){return console.log(`Updating product ${a} on Shopify:`,l),Promise.resolve()},async deleteProduct(a){return console.log(`Deleting product ${a} from Shopify`),Promise.resolve()}},K=R(a=>({productCache:{},singleProductCache:{},setProductCache:(l,h)=>a(d=>({productCache:{...d.productCache,[l]:h}})),setSingleProductCache:(l,h)=>a(d=>({singleProductCache:{...d.singleProductCache,[l]:h}})),clearCaches:()=>a(()=>({productCache:{},singleProductCache:{}}))})),j=400,U=()=>{const[a,l]=i.useState({content:[],totalPages:0,totalElements:0,size:0,number:0}),[h,d]=i.useState(!0),[q,T]=i.useState(null),[s,k]=i.useState({page:1,limit:12,totalItems:0,totalPages:0}),[c,F]=i.useState({}),g=i.useRef(null),{productCache:P,singleProductCache:m,setProductCache:b,setSingleProductCache:v,clearCaches:x}=K(),C=i.useCallback(()=>JSON.stringify({page:s.page,limit:s.limit,...c}),[s.page,s.limit,c]),u=i.useCallback(async()=>{d(!0),T(null);const o=C(),t=P[o];if(t){l(t),d(!1);return}try{let e=(await y.getProducts()).content||[];c.search&&(e=e.filter(r=>r.name.toLowerCase().includes(c.search.toLowerCase()))),c.category&&(e=e.filter(r=>r.productType==="Jewelry"&&r.category===c.category)),c.style&&(e=e.filter(r=>r.productType==="Jewelry"&&r.style===c.style)),c.metal&&(e=e.filter(r=>r.productType==="Jewelry"&&r.metal===c.metal)),c.clarityGrade&&(e=e.filter(r=>r.productType==="LooseStone"&&r.clarityGrade===c.clarityGrade)),c.rarity&&(e=e.filter(r=>r.productType==="CarvedIdol"&&r.rarity===c.rarity)),c.workmanshipGrade&&(e=e.filter(r=>r.productType==="CarvedIdol"&&r.workmanshipGrade===c.workmanshipGrade)),c.dateFrom&&(e=e.filter(r=>new Date(r.acquisitionDate)>=new Date(c.dateFrom))),c.dateTo&&(e=e.filter(r=>new Date(r.acquisitionDate)<=new Date(c.dateTo)));const p=e.length,I=Math.ceil(p/s.limit),E={content:e.slice((s.page-1)*s.limit,s.page*s.limit),totalPages:I,totalElements:p,size:s.limit,number:s.page};b(o,E),l(E),k(r=>({...r,totalItems:p,totalPages:I}))}catch(n){const e=n instanceof Error?n.message:"Failed to fetch products";T(e),f.error(e)}finally{d(!1)}},[C,s.page,s.limit,c,b]);i.useEffect(()=>{const o=C(),t=P[o];if(t){l(t),d(!1);return}return g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{u()},j),()=>{g.current&&clearTimeout(g.current)}},[C]);const w=()=>{Object.keys(P).forEach(o=>delete P[o])},L=i.useCallback(async o=>{if(m[o])return m[o];try{const t=await y.getProduct(o);return t&&v(o,t),t}catch{f.error("Failed to fetch product details");return}},[m,v]),S=()=>{Object.keys(m).forEach(o=>delete m[o])},M=i.useCallback(async o=>{try{const t=await y.createProduct(o),n=await D.createProduct(t),e=await y.updateProduct(t.id,{...t,platformIds:{...t.platformIds,shopifyId:n.id.toString()}});return w(),S(),u(),e}catch(t){const n=t instanceof Error?t.message:"Failed to add product";throw f.error(n),t}},[u]),G=i.useCallback(async(o,t)=>{var n;try{const e=await y.updateProduct(o,t);(n=e.platformIds)!=null&&n.shopifyId&&await D.updateProduct(parseInt(e.platformIds.shopifyId),e);const p=e.productType==="LooseStone"?e.quantity:e.inventoryQuantity;return p!==void 0&&e.reorderThreshold!==void 0&&p<e.reorderThreshold&&(console.log(`Reorder request for product ${e.name} (ID: ${e.id})`),f.info(`Reorder request for product ${e.name}`)),w(),S(),u(),e}catch(e){throw f.error("Failed to update product"),e}},[u]),J=i.useCallback(async o=>{try{return await y.deleteProduct(o),w(),S(),u(),!0}catch{return f.error("Failed to delete product"),!1}},[u]),$=i.useCallback(()=>{s.page<s.totalPages&&k(o=>({...o,page:o.page+1}))},[s.page,s.totalPages]),O=i.useCallback(()=>{const o=a.content||[],t=new Set;return o.forEach(n=>{n.productType==="Jewelry"&&n.category?t.add(n.category):n.productType==="LooseStone"&&n.gemstoneType?t.add(n.gemstoneType):n.productType==="CarvedIdol"&&n.material&&t.add(n.material)}),Array.from(t).sort()},[a.content]);return{products:a,loading:h,error:q,pagination:s,hasMore:s.page<s.totalPages,loadMore:$,filters:c,setFilters:F,addProduct:M,updateProduct:G,deleteProduct:J,getProduct:L,getCategories:O,refresh:u}};export{D as s,U as u};
