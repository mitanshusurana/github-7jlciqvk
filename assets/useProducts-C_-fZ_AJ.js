import{k as R,r as s,V as d}from"./index-feReXb3v.js";import{p as f}from"./productService-C4HRmSen.js";const _=r=>({id:Math.floor(Math.random()*1e6),title:r.name,body_html:r.description,vendor:r.supplier,product_type:r.productType,variants:[{price:r.price,sku:r.id,inventory_quantity:r.productType==="LooseStone"?r.quantity:1}]}),I={async createProduct(r){return console.log("Creating product on Shopify:",r),Promise.resolve({id:_(r).id})},async updateProduct(r,n){return console.log(`Updating product ${r} on Shopify:`,n),Promise.resolve()},async deleteProduct(r){return console.log(`Deleting product ${r} from Shopify`),Promise.resolve()}},J=R(r=>({productCache:{},singleProductCache:{},setProductCache:(n,g)=>r(i=>({productCache:{...i.productCache,[n]:g}})),setSingleProductCache:(n,g)=>r(i=>({singleProductCache:{...i.singleProductCache,[n]:g}})),clearCaches:()=>r(()=>({productCache:{},singleProductCache:{}}))})),N=400,U=()=>{const[r,n]=s.useState({content:[],totalPages:0,totalElements:0,size:0,number:0}),[g,i]=s.useState(!0),[M,b]=s.useState(null),[c,q]=s.useState({page:1,limit:12}),[y,k]=s.useState({totalItems:0,totalPages:0}),[P,F]=s.useState({}),p=s.useRef(null),{productCache:m,singleProductCache:h,setProductCache:T,setSingleProductCache:v,clearCaches:j}=J(),w=JSON.stringify(P),C=s.useCallback(()=>JSON.stringify({page:c.page,limit:c.limit,...P}),[c.page,c.limit,w]),l=s.useCallback(async()=>{i(!0),b(null);const t=C(),e=m[t];if(e){n(e),k({totalItems:e.totalElements,totalPages:e.totalPages}),i(!1);return}try{const a={page:c.page-1,size:c.limit,...P},o=await f.getProducts(a),u={content:o.content||[],totalPages:o.totalPages,totalElements:o.totalElements,size:o.size,number:o.number+1};T(t,u),n(u),k({totalItems:u.totalElements,totalPages:u.totalPages})}catch(a){const o=a instanceof Error?a.message:"Failed to fetch products";b(o),d.error(o)}finally{i(!1)}},[C,c.page,c.limit,w,T]);s.useEffect(()=>{const t=C(),e=m[t];if(e){n(e),i(!1);return}return p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{l()},N),()=>{p.current&&clearTimeout(p.current)}},[C,l]);const S=()=>{Object.keys(m).forEach(t=>delete m[t])},L=s.useCallback(async t=>{if(h[t])return h[t];try{const e=await f.getProduct(t);return e&&v(t,e),e}catch{d.error("Failed to fetch product details");return}},[h,v]),E=()=>{Object.keys(h).forEach(t=>delete h[t])},O=s.useCallback(async t=>{try{const e=await f.createProduct(t);return await I.createProduct(e),S(),E(),l(),e}catch(e){const a=e instanceof Error?e.message:"Failed to add product";throw d.error(a),e}},[l]),$=s.useCallback(async(t,e)=>{var a;try{const o=await f.updateProduct(t,e);(a=o.platformIds)!=null&&a.shopifyId&&await I.updateProduct(parseInt(o.platformIds.shopifyId),o);const u=o.productType==="LooseStone"?o.quantity:o.inventoryQuantity;return u!==void 0&&o.reorderThreshold!==void 0&&u<o.reorderThreshold&&(console.log(`Reorder request for product ${o.name} (ID: ${o.id})`),d.info(`Reorder request for product ${o.name}`)),S(),E(),l(),o}catch(o){throw d.error("Failed to update product"),o}},[l]),z=s.useCallback(async t=>{try{return await f.deleteProduct(t),S(),E(),l(),!0}catch{return d.error("Failed to delete product"),!1}},[l]),D=s.useCallback(()=>{c.page<y.totalPages&&q(t=>({...t,page:t.page+1}))},[c.page,y.totalPages]),K=s.useCallback(()=>{const t=r.content||[],e=new Set;return t.forEach(a=>{a.productType==="Jewelry"&&a.category?e.add(a.category):a.productType==="LooseStone"&&a.gemstoneType?e.add(a.gemstoneType):a.productType==="CarvedIdol"&&a.material&&e.add(a.material)}),Array.from(e).sort()},[r.content]);return{products:r,loading:g,error:M,pagination:{...c,...y},hasMore:c.page<y.totalPages,loadMore:D,filters:P,setFilters:F,addProduct:O,updateProduct:$,deleteProduct:z,getProduct:L,getCategories:K,refresh:l}};export{I as s,U as u};
